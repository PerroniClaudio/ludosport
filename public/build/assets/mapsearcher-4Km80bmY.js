const m=n=>({createSchoolMarker:function(t){this.infoWindowPinned=!1;let e=typeof t.coordinates=="string"?JSON.parse(t.coordinates):t.coordinates,s=new google.maps.Marker({position:e,map:this.map}),o=t.address||"",a=t.city||"",r=t.state||"",l=t.zip||"",h=t.country||"",c=e&&e.lat||"",d=e&&e.lng||"",p=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${c},${d}`)}`,i=new google.maps.InfoWindow({content:`
                    <div style='font-size:16px;font-weight:bold;'>
                        ${t.name||""}
                    </div>
                    <div style='font-size:14px;'>
                        ${o}<br>
                        ${a}${a&&r?", ":""}${r} ${l}<br>
                        ${h}
                    </div>
                    <div class="text-primary-500 font-semibold border-none focus:outline-none" style='margin-top:8px;'>
                        <a href="${p}" target="_blank" rel="noopener">Get directions on Google Maps</a>
                    </div>
                `});s.addListener("click",()=>{this.zoomToMarker(t.id),i.open(this.map,s),this.infoWindowPinned=!0,console.log("click ",this.infoWindowPinned?"true":"false")}),i.addListener("closeclick",()=>{this.infoWindowPinned=!1,console.log("closeclick ",this.infoWindowPinned?"true":"false")}),s.addListener("mouseover",()=>{i.open(this.map,s)}),s.addListener("mouseout",()=>{console.log("mouseout start ",this.infoWindowPinned?"true":"false"),this.infoWindowPinned||(i.close(),console.log("mouseout in ",this.infoWindowPinned?"true":"false"))}),this.map.addListener("click",()=>{i.close(),this.infoWindowPinned=!1}),this.markers.push({id:t.id,marker:s,infoWindow:i})},map:null,search:"",results:n,allResults:n,paginatedResults:[],currentPage:1,totalPages:0,nationFilter:"",markers:[],infoWindowPinned:!1,searchChanged:async function(){if(this.search.length===0){this.markers.forEach(e=>e.marker.setMap(null)),this.markers=[],this.results=this.allResults,this.currentPage=1,this.paginateResults();return}if(this.search.length<3)return;const t=await fetch(`/schools-search?location=${this.search}`);this.results=await t.json(),this.paginateResults(),this.markers.forEach(e=>e.marker.setMap(null)),this.markers=[],this.results.forEach(e=>{this.createSchoolMarker(e)}),this.results[0]&&this.results[0].id&&this.zoomToMarker(this.results[0].id)},zoomToMarker:function(t){let e=this.markers.find(s=>s.id===t);e&&(this.map.panTo(e.marker.getPosition()),this.map.setZoom(15))},paginateResults:function(){this.totalPages=Math.ceil(this.results.length/5),this.paginatedResults=this.results.slice((this.currentPage-1)*5,this.currentPage*5)},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage++,this.paginateResults())},prevPage:function(){this.currentPage>1&&(this.currentPage--,this.paginateResults())},fiterByNation:async function(t){this.results=n.filter(o=>o.nation_id==t),this.paginateResults();const e=this.results[0].coordinates;let s=new google.maps.Marker({position:e,map:this.map});this.map.panTo(s.getPosition()),this.map.setZoom(6),this.map.mapTypeId="roadmap"},async init(){const{Map:t}=await google.maps.importLibrary("maps");this.map=new t(document.getElementById("google-map"),{center:{lat:45.46404,lng:9.18938},zoom:2,mapTypeId:"satellite",mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain"]}}),this.paginateResults(),this.results.forEach(e=>{this.createSchoolMarker(e)})}});export{m as mapsearcher};
