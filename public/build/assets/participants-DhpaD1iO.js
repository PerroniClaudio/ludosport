const p=(c,n,l)=>({eventid:c,participants:[],filteredParticipants:[],availableUsers:[],paginatedUsers:[],currentPage:1,pageSize:10,totalPages:0,searchAvailablesValue:"",searchParticipantsValue:"",getAvailableUsers:async function(){console.log("getAvailableUsers");const t=`${n=="admin"?"":"/"+n}/events/${this.eventid}/available-users`,a=await fetch(t);if(a.ok){const i=await a.json();this.participants.length>0?this.availableUsers=i.filter(r=>!this.participants.some(e=>e.id===r.id)):this.availableUsers=i}},getParticipants:async function(){console.log("getParticipants");const t=`${n=="admin"?"":"/"+n}/events/${this.eventid}/participants`,a=await fetch(t);if(a.ok){const i=await a.json();Array.isArray(i)&&(this.participants=i,this.filteredParticipants=i,this.availableUsers.length>0&&(this.availableUsers=this.availableUsers.filter(r=>!this.participants.some(e=>e.id===r.id))))}},searchAvailableUsers:function(t){let a=t.target.value;if(a.length===0){this.paginateAvailableUsers();return}this.paginatedUsers=this.availableUsers.filter(i=>i.name.toLowerCase().includes(a.toLowerCase())||i.surname.toLowerCase().includes(a.toLowerCase()))},searchParticipants:function(t){console.log("searchParticipants");let a=t.target.value;return this.filteredParticipants=this.participants.filter(i=>i.name.toLowerCase().includes(a.toLowerCase())||i.surname.toLowerCase().includes(a.toLowerCase()))},addParticipant:async function(t){console.log("addParticipant");const a=this.availableUsers.find(s=>s.id===t);a&&this.participants.push(a);let i=JSON.stringify(this.participants.map(s=>s.id));const r=`${n=="admin"?"":"/"+n}/add-participants`,e=new FormData;e.append("event_id",this.eventid),e.append("participants",i),await fetch(r,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}),this.availableUsers=this.availableUsers.filter(s=>s.id!==t),this.searchAvailablesValue="",this.paginateAvailableUsers(),this.searchParticipantsValue="",this.searchParticipants({target:{value:""}})},hasRankingResult:function(t){let a=l.find(i=>i.user_id===t);return a?a.style_points>0||a.war_points>0:!1},removeParticipant:async function(t){console.log("removeParticipant");const a=this.participants.find(s=>s.id===t);a&&(this.participants=this.participants.filter(s=>s.id!==t));let i=JSON.stringify(this.participants.map(s=>s.id));const r=`${n=="admin"?"":"/"+n}/add-participants`,e=new FormData;e.append("event_id",this.eventid),e.append("participants",i),await fetch(r,{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e}),this.availableUsers.push(a),this.searchAvailablesValue="",this.paginateAvailableUsers(),this.searchParticipantsValue="",this.searchParticipants({target:{value:""}})},saveParticipants:async function(){console.log("saveParticipants")},paginateAvailableUsers:function(){const t=(this.currentPage-1)*this.pageSize,a=t+this.pageSize;this.paginatedUsers=this.availableUsers.slice(t,a),this.totalPages=Math.ceil(this.availableUsers.length/this.pageSize)},goToPage:function(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.paginateAvailableUsers())},init:async function(){await this.getAvailableUsers(),await this.getParticipants(),this.paginateAvailableUsers()}});export{p as participants};
