const m=(l={})=>{const c=(t=>t.getMonth()>=10?t.getFullYear()+1:t.getFullYear())(new Date),r=Array.isArray(l.yearOptions)?l.yearOptions:[],h=r.length>0?r[0]:null;return{events:[],selectedEvent:0,selectedEventData:{},athletesData:[],nationFilter:"",nation:[],eventName:"General Rankings",selectedYear:h??c,yearOptions:r,selectedSeasonDateISO(){const t=this.selectedYear??c;return new Date(t,9,31,23,59,59,999).toISOString()},onYearChange:async function(){this.page=1,this.selectedEvent&&this.selectedEvent!==0?await this.getDataForEvent(this.selectedEvent):this.nationFilter?await this.fiterByNation(this.nationFilter):await this.getGeneralRankings(),await this.getEventsList(this.nationFilter||null)},getEventsList:async function(t=null){const s=`/website-rankings/events/list?date=${this.selectedSeasonDateISO()}${t?"&nation="+t:""}`,n=await fetch(s);if(n.ok){const i=await n.json();this.events=i}},getDataForEvent:async function(t){this.selectedEvent=t,this.athletesData=[];const s=`/website-rankings/events/${this.selectedEvent}/rankings?date=${this.selectedSeasonDateISO()}`,n=await fetch(s);if(n.ok){const i=await n.json();let a=1;Object.entries(i).forEach(([e,o])=>{this.athletesData.push({id:e,name:o.user_name,rank:a++,battle_name:o.user_battle_name,academy:o.user_academy,school:o.user_school,school_slug:o.school_slug,nation:o.nation,war_points:o.total_war_points,style_points:o.total_style_points})})}this.rows=this.athletesData},getGeneralRankings:async function(){if(this.nationFilter!="")await this.fiterByNation(this.nationFilter);else{this.selectedEvent=0,this.athletesData=[],this.eventName="General Rankings";const t=`/website-rankings/general?date=${this.selectedSeasonDateISO()}`,s=await fetch(t);if(s.ok){const n=await s.json();let i=1;Object.entries(n).forEach(([a,e])=>{this.athletesData.push({id:a,name:e.user_name,rank:i++,battle_name:e.user_battle_name,academy:e.user_academy,school:e.user_school,school_slug:e.school_slug,nation:e.nation,war_points:e.total_war_points,style_points:e.total_style_points})})}this.rows=this.athletesData}},resetToGeneralRankings:function(){this.nationFilter="",this.getGeneralRankings(),this.getEventsList()},fiterByNation:async function(t){if(t==""){this.getGeneralRankings(),this.getEventsList();return}await this.getEventsList(t),this.events=this.events.filter(a=>a.nation_id==t),this.athletesData=[];const n=await(await fetch(`/website-rankings/nation/${t}/rankings?date=${this.selectedSeasonDateISO()}`)).json();let i=1;Object.entries(n.results).forEach(([a,e])=>{this.athletesData.push({id:a,name:e.user_name,rank:i++,battle_name:e.user_battle_name,academy:e.user_academy,school:e.user_school,school_slug:e.school_slug,nation:e.nation,war_points:e.total_war_points,style_points:e.total_style_points})}),this.eventName="National Rankings - "+n.nation.name,this.nation=n.nation,this.rows=this.athletesData,this.selectedEvent=0},columns:[{name:"Rank",field:"rank",columnClasses:""},{name:"Name",field:"name",columnClasses:""},{name:"Academy",field:"academy",columnClasses:""},{name:"School",field:"school",columnClasses:""},{name:"Nation",field:"nation",columnClasses:""},{name:"Arena Points",field:"war_points",columnClasses:""},{name:"Style Points",field:"style_points",columnClasses:""}],sortColumn:null,sortDirection:"asc",rows:[],sort:function(t){this.sortColumn===t?this.sortDirection=this.sortDirection==="asc"?"desc":"asc":(this.sortColumn=t,this.sortDirection="asc"),this.rows=[...this.rows].sort((s,n)=>{const i=this.columns[t],a=String(s[i.field]),e=String(n[i.field]);return!isNaN(a)&&!isNaN(e)?this.sortDirection==="asc"?a-e:e-a:this.sortDirection==="asc"?String(a).localeCompare(String(e)):String(e).localeCompare(String(a))})},searchByValue:function(t){const s=t.target.value.toLowerCase();s===""?this.rows=this.athletesData:this.rows=this.athletesData.filter(n=>Object.values(n).some(i=>String(i).toLowerCase().includes(s)))},page:1,pageLength:10,totalPages:function(){return Math.ceil(this.rows.length/this.pageLength)},paginatedRows:function(){const t=(this.page-1)*this.pageLength,s=t+this.pageLength;return this.rows.slice(t,s)},init(){this.getGeneralRankings(),this.getEventsList()}}};export{m as rankingschart};
