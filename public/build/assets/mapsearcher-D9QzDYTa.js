const g=o=>({map:null,search:"",results:o,allResults:o,paginatedResults:[],currentPage:1,totalPages:0,nationFilter:"",markers:[],searchChanged:async function(){if(this.search.length===0){this.markers.forEach(t=>t.marker.setMap(null)),this.markers=[],this.results=this.allResults,this.currentPage=1,this.paginateResults();return}if(this.search.length<3)return;const a=await fetch(`/schools-search?location=${this.search}`);this.results=await a.json(),this.paginateResults(),this.markers.forEach(t=>t.marker.setMap(null)),this.markers=[],this.results.forEach(t=>{let e=JSON.parse(t.coordinates),s=new google.maps.Marker({position:e,map:this.map});s.addListener("click",()=>{this.zoomToMarker(t.id)}),this.markers.push({id:t.id,marker:s})}),this.results[0]&&this.results[0].id&&this.zoomToMarker(this.results[0].id)},zoomToMarker:function(a){let t=this.markers.find(e=>e.id===a);t&&(this.map.panTo(t.marker.getPosition()),this.map.setZoom(15))},paginateResults:function(){this.totalPages=Math.ceil(this.results.length/5),this.paginatedResults=this.results.slice((this.currentPage-1)*5,this.currentPage*5)},nextPage:function(){this.currentPage<this.totalPages&&(this.currentPage++,this.paginateResults())},prevPage:function(){this.currentPage>1&&(this.currentPage--,this.paginateResults())},fiterByNation:async function(a){this.results=o.filter(s=>s.nation_id==a),this.paginateResults();const t=this.results[0].coordinates;let e=new google.maps.Marker({position:t,map:this.map});this.map.panTo(e.getPosition()),this.map.setZoom(6),this.map.mapTypeId="roadmap"},async init(){const{Map:a}=await google.maps.importLibrary("maps");let t=!1;this.map=new a(document.getElementById("google-map"),{center:{lat:45.46404,lng:9.18938},zoom:2,mapTypeId:"satellite",mapTypeControlOptions:{mapTypeIds:["roadmap","satellite","hybrid","terrain"]}}),this.paginateResults(),this.results.forEach(e=>{let s=new google.maps.Marker({position:e.coordinates,map:this.map}),l=e.address||"",r=e.city||"",n=e.state||"",h=e.zip||"",p=e.country||"",c=e.coordinates&&e.coordinates.lat||"",m=e.coordinates&&e.coordinates.lng||"",d=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(`${c},${m}`)}`,i=new google.maps.InfoWindow({content:`
                        <div style='font-size:16px;font-weight:bold;'>
                            ${e.name||""}
                        </div>
                        <div style='font-size:14px;'>
                            ${l}<br>
                            ${r}${r&&n?", ":""}${n} ${h}<br>
                            ${p}
                        </div>
                        <div class="text-primary-500 font-semibold" style='margin-top:8px;'>
                            <a href="${d}" target="_blank" rel="noopener">Get directions on Google Maps</a>
                        </div>
                    `});s.addListener("click",()=>{this.zoomToMarker(e.id),i.open(this.map,s),t=!0,console.log("click ",t?"true":"false")}),i.addListener("closeclick",()=>{t=!1,console.log("closeclick ",t?"true":"false")}),s.addListener("mouseover",()=>{i.open(this.map,s)}),s.addListener("mouseout",()=>{console.log("mouseout start ",t?"true":"false"),t||(i.close(),console.log("mouseout in ",t?"true":"false"))}),this.map.addListener("click",()=>{i.close(),t=!1}),this.markers.push({id:e.id,marker:s,infoWindow:i})})}});export{g as mapsearcher};
